name: FLUX TEST

on:
  workflow_dispatch:

jobs:
  fluxpipe:
    runs-on: ubuntu-latest
    steps:
    - uses: lmangani/flux-github-action@use-latest-ghcr
    - env:
        KEY_NAME: fluxpipe
      run: |
        curl -XPOST localhost:8086/api/v2/query -sS \
        -H 'Accept:application/csv' \
        -H 'Content-type:application/vnd.flux' \
        --data-binary @- << EOF
          import "array"
          import "runtime"
          array.from(rows: [{version: runtime.version() }])
        EOF
